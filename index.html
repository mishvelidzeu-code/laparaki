<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ áƒ®áƒ›áƒ áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒáƒ“</title>

<meta name="theme-color" content="#2563eb">
<link rel="apple-touch-icon" href="icon-192.png">

<script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:#f5f7ff;
  color:#0f172a;
}
.container{max-width:1200px;margin:auto;padding:20px}
.header{
  background:#2563eb;
  color:#fff;
  padding:24px;
  border-radius:18px;
  text-align:center;
}
.main{
  margin-top:20px;
  background:#fff;
  padding:20px;
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}
textarea{
  width:100%;
  height:40vh;
  min-height:220px;
  padding:16px;
  font-size:18px;
  line-height:1.6;
  border-radius:14px;
  border:1px solid #cbd5e1;
  outline:none;
}
textarea:focus{border-color:#2563eb}

.controls{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:14px;
  justify-content:center;
}
.controls button{
  padding:12px 22px;
  border:none;
  border-radius:12px;
  cursor:pointer;
  font-weight:600;
  font-size:15px;
  transition: opacity 0.2s;
}
.controls button:active { opacity: 0.7; }

.start{background:#2563eb;color:#fff}
.stop{background:#dc2626;color:#fff}
.copy{background:#16a34a;color:#fff}
.clear{background:#64748b;color:#fff}
.word{background:#0f4c81;color:#fff}

.settings{
  margin-top:14px;
  font-size:14px;
  display:flex;
  align-items:center;
  gap:10px;
  color:#475569;
  justify-content:center;
}
.indicator{
  margin-top:10px;
  font-size:14px;
  color:#2563eb;
  display:none;
  font-weight:bold;
  text-align:center;
}
select{
  padding:6px;
  border-radius:6px;
  border:1px solid #cbd5e1;
}
@media (max-width: 768px){
  textarea{
    height:32vh;
    min-height:180px;
  }
}

</style>
</head>

<body>
<div class="container">

<div class="header">
  <h1>áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ áƒ®áƒ›áƒ áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒáƒ“</h1>
  <p>áƒáƒ•áƒ¢áƒáƒ›áƒáƒ¢áƒ£áƒ áƒ˜ áƒáƒ£áƒœáƒ¥áƒ¢áƒ£áƒáƒªáƒ˜áƒ â€¢ áƒáƒ‘áƒ–áƒáƒªáƒ”áƒ‘áƒ˜ â€¢ áƒ£áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒ</p>
</div>

<div class="main">

<textarea id="text" spellcheck="false"
placeholder="áƒ“áƒáƒ˜áƒ¬áƒ§áƒ” áƒšáƒáƒáƒáƒ áƒáƒ™áƒ˜â€¦"></textarea>

<div class="indicator" id="paragraphIndicator">âš¡ áƒáƒ®áƒáƒšáƒ˜ áƒáƒ‘áƒ–áƒáƒªáƒ˜</div>

<div class="settings">
  <span>áƒáƒáƒ£áƒ–áƒ áƒáƒ‘áƒ–áƒáƒªáƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡:</span>
  <select id="pauseSelect">
    <option value="2000">2 áƒ¬áƒáƒ›áƒ˜</option>
    <option value="3000" selected>3 áƒ¬áƒáƒ›áƒ˜</option>
    <option value="5000">5 áƒ¬áƒáƒ›áƒ˜</option>
  </select>
</div>

<div class="controls">
  <button class="start" onclick="startRec()">ğŸ™ï¸ áƒ“áƒáƒ¬áƒ§áƒ”áƒ‘áƒ</button>
  <button class="stop" onclick="stopRec()">ğŸ›‘ áƒ¨áƒ”áƒ©áƒ”áƒ áƒ”áƒ‘áƒ</button>
  <button class="copy" onclick="copyText()">ğŸ“‹ áƒ™áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ</button>
  <button class="clear" onclick="clearText()">ğŸ—‘ï¸ áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ</button>
  <button class="word" onclick="downloadWord()">ğŸ“„ Word</button>
</div>

</div>
</div>

<script>
let recognition;
let finalText = "";
let manuallyStopped = true; // áƒ—áƒáƒ•áƒ˜áƒ“áƒáƒœ áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ
let lastResultTime = Date.now();

function cleanText(t){
  return t.replace(/[\u0000-\u001F\u007F-\u009F\u200B-\u200D\uFEFF]/g,"");
}

/* áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ áƒ’áƒ áƒáƒ›áƒáƒ¢áƒ˜áƒ™áƒ£áƒšáƒ˜ áƒáƒ£áƒœáƒ¥áƒ¢áƒ£áƒáƒªáƒ˜áƒ */
function smartPunctuation(text){
  text = text.trim();
  if(!text) return "";

  // áƒ›áƒ«áƒ˜áƒ›áƒ˜áƒ¡ áƒ©áƒáƒ¡áƒ›áƒ áƒ™áƒáƒ•áƒ¨áƒ˜áƒ áƒ”áƒ‘áƒ—áƒáƒœ (áƒ“áƒáƒ•áƒáƒ›áƒáƒ¢áƒ”áƒ— "áƒ áƒáƒ›")
  text = text.replace(/\s+(áƒ›áƒáƒ’áƒ áƒáƒ›|áƒ—áƒ£áƒ›áƒªáƒ|áƒ áƒáƒ“áƒ’áƒáƒœ|áƒ®áƒáƒšáƒ|áƒ áƒáƒ›)\s+/gi, ", $1 ");

  const questionWords = /^(áƒ áƒáƒ¢áƒáƒ›|áƒ áƒáƒ’áƒáƒ |áƒ áƒáƒ“áƒ˜áƒ¡|áƒ¡áƒáƒ“|áƒ•áƒ˜áƒœ|áƒ•áƒ˜áƒ¡|áƒ áƒáƒ¡|áƒ áƒáƒ›áƒ”áƒšáƒ˜|áƒ áƒáƒ›áƒ“áƒ”áƒœáƒ˜|áƒœáƒ£áƒ—áƒ£|áƒ®áƒáƒ›)\b/i;
  const exclaimWords = /^(áƒ«áƒáƒšáƒ˜áƒáƒœ|áƒ’áƒ—áƒ®áƒáƒ•|áƒáƒ£áƒªáƒ˜áƒšáƒ”áƒ‘áƒšáƒáƒ“|áƒ¤áƒ áƒ—áƒ®áƒ˜áƒšáƒáƒ“|áƒ•áƒáƒ£|áƒ£áƒáƒ£|áƒ¨áƒ”áƒ¡áƒáƒœáƒ˜áƒ¨áƒœáƒáƒ•áƒ˜áƒ)\b/i;

  if(questionWords.test(text)) return text + "? ";
  if(exclaimWords.test(text)) return text + "! ";

  return text + ". ";
}

if("webkitSpeechRecognition" in window){
  recognition = new webkitSpeechRecognition();
  recognition.lang = "ka-GE";
  recognition.continuous = true;
  recognition.interimResults = true;
recognition.onerror = function(e){
  alert("áƒ®áƒ›áƒ˜áƒ¡ áƒáƒ›áƒáƒªáƒœáƒáƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: " + e.error);
};


  recognition.onresult = e => {
    const now = Date.now();
    const PAUSE = Number(pauseSelect.value);
    let interim = "";

    for(let i=e.resultIndex; i<e.results.length; i++){
      let t = cleanText(e.results[i][0].transcript);

      if(e.results[i].isFinal){
        let gap = now - lastResultTime;

        if(gap >= PAUSE && finalText.trim().length > 0){
          finalText = finalText.trim() + "\n\n";
          showIndicator();
        }

        const isNewParagraph = gap >= PAUSE;
finalText += smartPunctuation(t, isNewParagraph);

        lastResultTime = now;
      } else {
        interim += t;
      }
    }

    // áƒ•áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ— áƒ–áƒ”áƒ“áƒ›áƒ”áƒ¢ áƒ°áƒáƒ áƒ”áƒ‘áƒ¡ áƒ áƒ”áƒáƒšáƒ£áƒ  áƒ“áƒ áƒáƒ¨áƒ˜
    text.value = (finalText + interim).replace(/\s+/g, " ");
    text.scrollTop = text.scrollHeight;
  };

  recognition.onend = ()=>{
    if(!manuallyStopped){
      try{recognition.start()}catch(err){}
    }
  };
} else {
  alert("áƒ’áƒáƒ›áƒáƒ˜áƒ§áƒ”áƒœáƒ” Google Chrome");
}

function startRec(){
  try{
    manuallyStopped = false;
    finalText = text.value.trim() ? text.value.trim() + " " : "";
    recognition.start();
  } catch(e){
    alert("áƒ›áƒ˜áƒ™áƒ áƒáƒ¤áƒáƒœáƒ˜áƒ¡ áƒ©áƒáƒ áƒ—áƒ•áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ. áƒ©áƒáƒ áƒ—áƒ”áƒ— áƒœáƒ”áƒ‘áƒáƒ áƒ—áƒ•áƒ áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ¨áƒ˜.");
  }
}


function stopRec(){
  manuallyStopped = true;
  recognition.stop();
}

function showIndicator(){
  paragraphIndicator.style.display="block";
  setTimeout(()=>paragraphIndicator.style.display="none",1200);
}

function copyText(){
  navigator.clipboard.writeText(text.value.trim());
}

function clearText(){
  if(confirm("áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜áƒ¡ áƒ¡áƒ áƒ£áƒšáƒáƒ“ áƒ¬áƒáƒ¨áƒšáƒ?")){
    finalText="";
    text.value="";
  }
}

function downloadWord(){
  const { Document, Packer, Paragraph, TextRun, AlignmentType } = window.docx;
  const lines = text.value.split(/\n\n/);

  const doc = new Document({
    sections:[{
      children: lines.filter(l=>l.trim()).map(l =>
        new Paragraph({
          alignment: AlignmentType.JUSTIFIED,
          spacing:{ after:200 },
          children:[
            new TextRun({
              text:l.trim(),
              font: "Sylfaen",
              size: 24,
              language:{ id:"ka-GE" },
              noProof:true
            })
          ]
        })
      )
    }]
  });

  Packer.toBlob(doc).then(b=>{
    saveAs(b,"qartuli_teqsti.docx");
  });
}
</script>

</body>
</html>