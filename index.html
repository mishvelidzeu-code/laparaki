<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ áƒ®áƒ›áƒ</title>
<style>
  body{margin:0;font-family:system-ui,-apple-system,sans-serif;background:#f0f2f5;padding:20px;text-align:center;}
  textarea{width:100%;height:300px;font-size:18px;padding:15px;border-radius:12px;border:1px solid #ccc;margin-bottom:20px;}
  button{padding:20px;font-size:18px;border-radius:12px;border:none;cursor:pointer;margin:5px;color:white;font-weight:bold;}
  .btn-start{background:#007AFF;}
  .btn-stop{background:#FF3B30;}
  .btn-copy{background:#34C759;}
  #status{margin-bottom:10px;color:#666;font-size:14px;}
</style>
</head>
<body>

<h3>ğŸ™ï¸ áƒ©áƒáƒ¬áƒ”áƒ áƒ (iOS áƒ¢áƒ”áƒ¡áƒ¢áƒ˜)</h3>
<p id="status">áƒ“áƒáƒáƒ­áƒ˜áƒ áƒ”áƒ— áƒšáƒ£áƒ áƒ¯ áƒ¦áƒ˜áƒšáƒáƒ™áƒ¡</p>

<textarea id="textBox" placeholder="áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜ áƒáƒ¥ áƒ’áƒáƒ›áƒáƒ©áƒœáƒ“áƒ”áƒ‘áƒ..."></textarea>

<br>
<button class="btn-start" onclick="startListening()">áƒ“áƒáƒ¬áƒ§áƒ”áƒ‘áƒ</button>
<button class="btn-stop" onclick="stopListening()">áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ</button>
<button class="btn-copy" onclick="copyText()">áƒ™áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ</button>

<script>
// áƒ’áƒšáƒáƒ‘áƒáƒšáƒ£áƒ áƒ˜ áƒªáƒ•áƒšáƒáƒ“áƒ”áƒ‘áƒ˜
let recognition = null;
let isRunning = false;
let fullText = "";

function startListening() {
    // 1. áƒ¢áƒ”áƒ¡áƒ¢áƒ˜ - áƒ áƒ”áƒáƒ’áƒ˜áƒ áƒ”áƒ‘áƒ¡ áƒ—áƒ£ áƒáƒ áƒ áƒ¦áƒ˜áƒšáƒáƒ™áƒ˜
    console.log("áƒ¦áƒ˜áƒšáƒáƒ™áƒ¡ áƒ“áƒáƒ”áƒ­áƒ˜áƒ áƒ");
    
    // 2. áƒ¨áƒ”áƒ•áƒáƒ›áƒáƒ¬áƒ›áƒáƒ— áƒáƒ¥áƒ•áƒ¡ áƒ—áƒ£ áƒáƒ áƒ áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ¡ áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ
    if (!('webkitSpeechRecognition' in window)) {
        alert("áƒ£áƒ™áƒáƒªáƒ áƒáƒ•áƒáƒ“, áƒáƒ› áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ¡ (áƒáƒœ áƒáƒ˜áƒ¤áƒáƒœáƒ˜áƒ¡ áƒáƒ› áƒ•áƒ”áƒ áƒ¡áƒ˜áƒáƒ¡) áƒáƒ  áƒáƒ¥áƒ•áƒ¡ áƒ®áƒ›áƒ˜áƒ¡ áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ.");
        return;
    }

    // 3. áƒ—áƒ£ áƒ£áƒ™áƒ•áƒ” áƒ©áƒáƒ áƒ—áƒ£áƒšáƒ˜áƒ, áƒáƒ áƒáƒ¤áƒ”áƒ áƒ˜ áƒ•áƒ¥áƒœáƒáƒ—
    if (isRunning) return;

    // 4. áƒ›áƒ˜áƒ™áƒ áƒáƒ¤áƒáƒœáƒ˜áƒ¡ áƒáƒ‘áƒ˜áƒ”áƒ¥áƒ¢áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ (áƒ›áƒ®áƒáƒšáƒáƒ“ áƒ“áƒáƒ­áƒ”áƒ áƒ˜áƒ¡áƒáƒ¡!)
    if (!recognition) {
        const SpeechRec = window.webkitSpeechRecognition;
        recognition = new SpeechRec();
        recognition.lang = 'ka-GE';
        recognition.continuous = false; // áƒáƒ˜áƒ¤áƒáƒœáƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡ áƒáƒ£áƒªáƒ˜áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜áƒ false
        recognition.interimResults = true;

        // áƒ¨áƒ”áƒ“áƒ”áƒ’áƒ˜áƒ¡ áƒ›áƒ˜áƒ¦áƒ”áƒ‘áƒ
        recognition.onresult = function(event) {
            let interim = "";
            for (let i = event.resultIndex; i < event.results.length; i++) {
                if (event.results[i].isFinal) {
                    fullText += smartPunctuate(event.results[i][0].transcript);
                } else {
                    interim += event.results[i][0].transcript;
                }
            }
            document.getElementById('textBox').value = fullText + interim;
            document.getElementById('textBox').scrollTop = document.getElementById('textBox').scrollHeight;
        };

        // áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ/áƒ áƒ”áƒ¡áƒ¢áƒáƒ áƒ¢áƒ˜
        recognition.onend = function() {
            if (isRunning) {
                // áƒ—áƒ£ áƒ©áƒ•áƒ”áƒœ áƒáƒ  áƒ’áƒáƒ’áƒ•áƒ˜áƒ©áƒ”áƒ áƒ”áƒ‘áƒ˜áƒ, áƒ—áƒáƒ•áƒ˜áƒ“áƒáƒœ áƒ©áƒáƒ˜áƒ áƒ—áƒáƒ¡
                try { recognition.start(); } catch(e){}
            } else {
                document.getElementById('status').innerText = "áƒ’áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ";
                document.getElementById('status').style.color = "red";
            }
        };

        recognition.onerror = function(event) {
            // áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ˜áƒ¡ áƒ©áƒ•áƒ”áƒœáƒ”áƒ‘áƒ áƒ”áƒ™áƒ áƒáƒœáƒ–áƒ”, áƒ áƒáƒ› áƒ’áƒáƒ•áƒ˜áƒ’áƒáƒ— áƒ áƒ áƒ®áƒ“áƒ”áƒ‘áƒ
            document.getElementById('status').innerText = "áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ: " + event.error;
            if (event.error === 'not-allowed') {
                alert("áƒáƒáƒ áƒáƒ›áƒ”áƒ¢áƒ áƒ”áƒ‘áƒ˜áƒ“áƒáƒœ áƒ›áƒ˜áƒ”áƒªáƒ˜áƒ— Safari-áƒ¡ áƒ›áƒ˜áƒ™áƒ áƒáƒ¤áƒáƒœáƒ˜áƒ¡ áƒ£áƒ¤áƒšáƒ”áƒ‘áƒ!");
            }
        };
    }

    // 5. áƒ“áƒáƒ¬áƒ§áƒ”áƒ‘áƒ
    try {
        isRunning = true;
        recognition.start();
        document.getElementById('status').innerText = "áƒ’áƒ˜áƒ¡áƒ›áƒ”áƒœáƒ—... áƒ˜áƒšáƒáƒáƒáƒ áƒáƒ™áƒ”áƒ—";
        document.getElementById('status').style.color = "green";
    } catch (e) {
        alert("áƒ•áƒ”áƒ  áƒ©áƒáƒ˜áƒ áƒ—áƒ: " + e.message);
    }
}

function stopListening() {
    isRunning = false;
    if (recognition) recognition.stop();
    document.getElementById('status').innerText = "áƒ¨áƒ”áƒ©áƒ”áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ";
}

function copyText() {
    const txt = document.getElementById('textBox');
    txt.select();
    navigator.clipboard.writeText(txt.value);
    alert("áƒ™áƒáƒáƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ");
}

function smartPunctuate(str) {
    str = str.trim();
    if (!str) return "";
    // áƒ›áƒáƒ áƒ¢áƒ˜áƒ•áƒ˜ áƒáƒ£áƒœáƒ¥áƒ¢áƒ£áƒáƒªáƒ˜áƒ
    if (str.match(/^(áƒ áƒáƒ¢áƒáƒ›|áƒ¡áƒáƒ“|áƒ áƒáƒ“áƒ˜áƒ¡|áƒ•áƒ˜áƒœ|áƒ áƒáƒ¡)/i)) return str + "? ";
    return str + ". ";
}
</script>

</body>
</html>